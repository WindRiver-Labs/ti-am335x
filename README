        TI AM335xEVM-SK Boards


1. About this document
======================
This document describes the common and non-hardware specific information.
Please refer to README.hardware for hardware specific information.

Dependencies
------------
This layer depends on the oe-core version supplied with Wind River Linux
and the wr-kernel layer.


Maintenance
-----------
This layer is maintained by Wind River Systems, Inc.
Contact <support@windriver.com> or your support representative for more
information on submitting changes.


Building the ti-am335x layer
---------------------------
This layer and wr-kernel layer should be added to bblayers.conf. This
is done automatically when using the Wind River configure wrapper.


License
-------
Copyright (C) 2017 Wind River Systems, Inc.

The right to copy, distribute or otherwise make use of this software may
be licensed only pursuant to the terms of an applicable Wind River license
agreement. No license to Wind River intellectual properly rights is granted
herein. All rights not licensed by Wind River are reserved by Wind River.

Source code included in tree for individual recipes is under the LICENSE
stated in each recipe (.bb file) unless other stated.


2. BSP Kernel and RootFS Combination
====================================

The validity of WindRiver Linux kernel and RootFS combination for this BSP is
in the table.
The leftmost column of the table is the kernel type, and the top line is the
RootFS type.
'Y' in each content cell stands for the combination is supported; 'N' stands
for not supported:

--------------------------------------------------------------------
| kernel/rootfs | glibc_std | glibc_small | glibc_cgl | glibc_tiny |
--------------------------------------------------------------------
|   standard    |     Y     |      Y      |     N     |     N      |
--------------------------------------------------------------------
|   preempt_rt  |     Y     |      Y      |     N     |     N      |
--------------------------------------------------------------------

3. Board Specific Patches
=========================
To get a list of patches applied to the kernel specific to this BSP
along with patch descriptions use git-whatchanged on the default
kernel (git whatchanged <kernel_type>/base..<kernel_type>/<bsp_name>).
For example:

  # cd build/linux-windriver-<version>/linux

For ti-am335x:
  # git whatchanged standard/base..standard/ti-am335x


4 Boot Instructions
====================

4.1 NFS Root File System
------------------------

Configure u-boot with target IP, tftp server, netmask and other required
network values.
 > tftp    0x80200000 "/<tftp root>/zImage"
 > tftp    0x80f80000 "/<tftp root>/dtb"
 > setenv bootargs console=ttyO0,115200 root=/dev/nfs rw \
          nfsroot=<nfs server>:<nfs root>,nolock ip=dhcp\
          ip=<target IP>::<gateway>:<netmask>::eth0:off
 > bootz 0x80200000 - 0x80f80000

 or use the env variable:
 > set serverip $addr
 > set ipaddr   $addr
 > set netargs setenv bootargs console=ttyO0,115200n8 root=/dev/nfs \
                      nfsroot=<IP>:<nfs_dir>,nolock rw ip=dhcp;
 > setenv autoload no;run netargs;
 > bootz 0x80200000 - 0x80f80000

Keep in mind that some drivers for the DSP may require 2MB of memory set
aside for communications buffers. In this case, set mem=254M.


4.2 Rootfs on MMC/SD
--------------------

An ext2/ext3 filesystem can be created on the MMC/SD using standard
techniques. The device appears as /dev/mmcblk0 and the first partition
will appear as /dev/mmcblk0p1.

4.2.1 Deployment
----------------

After loading the kernel, pass kernel arguments like following:

    root=/dev/mmcblk0p2 rw console=ttyO0,115200n8 rootwait


5. Features Notes
=================

5.1 Crypto engine
-----------------

5.1.1 Usage and verification
----------------------------

openssl without cryptodev:

	# openssl speed -evp aes-128-cbc
	  3s on 16 size blocks: 3506326 aes-128-cbc's in 3.00s
  	  3s on 64 size blocks: 1060720 aes-128-cbc's in 3.00s
	  3s on 256 size blocks: 282339 aes-128-cbc's in 3.00s
	  3s on 1024 size blocks: 71710 aes-128-cbc's in 3.00s
	  3s on 8192 size blocks: 9005 aes-128-cbc's in 3.00s
	  OpenSSL 1.0.1e 11 Feb 2013
	  built on: Wed Mar 12 11:58:49 CST 2017

openssl with cryptodev:

	# modprobe cryptodev
	  cryptodev: driver 1.6 loaded.
        # openssl speed -evp aes-128-cbc
 	  3s on 16 size blocks: 43127 aes-128-cbc's in 0.02s
 	  3s on 64 size blocks: 34100 aes-128-cbc's in 0.11s
 	  3s on 256 size blocks: 27633 aes-128-cbc's in 0.06s
 	  3s on 1024 size blocks: 19539 aes-128-cbc's in 0.04s
 	  3s on 8192 size blocks: 6836 aes-128-cbc's in 0.02s
 	  OpenSSL 1.0.1e 11 Feb 2013
 	  built on: Wed Mar 12 11:58:49 CST 2016

5.1.2 Target Notes
------------------

make sure openssl is right for ioctl.


5.2 Audio
---------

5.2.1 Usage and verification
----------------------------

	# aplay foobar.wav

5.2.2 Target Notes
------------------

There is no in-line or mic output pins for EVMSK board.

5.3 PM suspend
--------------

5.3.1 Usage and verification
----------------------------

	# echo standby > /sys/power/state

5.3.2 Target Notes
------------------

PM suspend supports two modes standby and freeze, mem is not supported as
SDK, and the current CM3 firmware version is 0x192

5.4 PM cpufreq
--------------

5.4.1 Usage and verification
----------------------------

  cpufreq:

    # cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors
    conservative ondemand userspace powersave performance
    # cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
    720000
    # cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies
    275000 500000 600000 720000
    # echo 275000 > /sys/devices/system/cpu/cpu0/cpufreq/scaling_setspeed
    # cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
    275000

5.4.1 Note
----------

CPUFreq can only be tested by userspace mode.


5.5 PM CPU idle
---------------

5.5.1 Usage and verification
----------------------------

There are two states for ti-am335x, which are C0, C1 as follows:

root@localhost:/sys/devices/system/cpu/cpu0/cpuidle# ls -lR
.:
total 0
drwxr-xr-x 2 root root 0 Mar 12 00:46 state0
drwxr-xr-x 2 root root 0 Mar 12 00:46 state1


They can be disabled by echo 1 > disable as follows:

root@localhost:/sys/devices/system/cpu/cpu0/cpuidle/state1# cat disable
0
root@localhost:/sys/devices/system/cpu/cpu0/cpuidle/state1# echo 1 > disable
root@localhost:/sys/devices/system/cpu/cpu0/cpuidle/state1# cat disable
1

5.5.1 Note
----------

Since DDR2 is deprecated currently, C2 SR has been removed from SDK. So there
are only two idle states in the latest SDK.

5.6 Touch Screen
----------------

5.6.1 Usage and verification
----------------------------

Touch screen calibration will be done when boot, and there is also a program
in desktop when matchbox starts.

5.7 Bluetooth
-------------

5.7.1 Usage and verification
----------------------------

Bluetooth:

	# modprobe st_drv (skipped if 'lsmod | grep st_drv' is set )
	# uim-sysfs start
	# rfkill unblock bluetooth
	# modprobe btwilink
	# hciconfig hci0 up
	# hcitool -i hci0 scan 
	Scanning ...
		16:E8:30:F2:66:12       lenovo A200

5.7.2 Target Notes
------------------

If there is no outpu when "modprobe btwilink",  which means the communication
between BT module and HCI is down by UART1, the whole system is not very well
because of hardware and software, and WL12xx has been dropped in the latest
SD, suggestion:

	# hciconfig hci0 down
	# rmmod btwilink
	# uim-sysfs stop
	# rmmod st_drv

Then do all steps in 5.7.1 again.

Make sure the match between firmware version and your HD wireless module,
and rfkill set is right for bluetooth. Current version is TIInit_7.6.15.
And suppose st-drv module has been installed for the steps above..

5.8 WLAN
--------

5.8.1 Usage and verification
----------------------------

WiFi:
	# rfkill unblock wlan 
	# ifconfig wlan0 up 
	# iwlist  wlan0  scanning

5.8.2 Target Notes
------------------

Make sure the match between firmware version and your HD wireless module, and
rfkill set is right for wlan. The default firmare is wl127x, but unlucky, it
has been dropped in the latest SD, please contact the board vendor for more
information.

5.9 Watchdog
-------------

5.9.1 Usage and verification
-----------------------------

	# pkill watchdog

5.9.2 Target Notes
-------------------

Please refer to 8.1.13.5.3 PRM_RSTST Register in AM335x ARM CortexTM-A8 Microprocessors
(MPUs) Technical Reference Manual for more information.


5.10 Touchscreen
----------------

5.10.1 Usage and verification
-----------------------------

There will be a calibration program when matchbox starts in sato mode, so it's
OK to do screen calibration

5.10.2 Target Notes
-------------------

machconfig and pointcal-xinput are BSP specific utilities.


5.11 Usb

5.11.1 Usage and verification
-----------------------------

Host mode is OK as-is, the following example for device mode:
	# modprobe g_multi "file=/dev/mmcblk0p1"

5.11.2 Target Notes
-------------------

Please refer to the following script for more usb gadget usages:
  https://github.com/RobertCNelson/boot-scripts/blob/master/boot/am335x_evm.sh

5.12 PWMSS

5.12.1 Usage and verification
-----------------------------
	The lcd brightness is controlled by ecap.
	the brightness will be changed:
	# echo 0~8 > /sys/devices/platform/backlight/backlight/backlight/brightness

5.13 Graphics SGX

Currently the third party lib APIs are not integrated, but these kernel modules
pvr-related have been verified in SDK environment, and the wrlinux-std-sato is
the default distro to build graphics staffs.

5.13.1 Usage and verification
-----------------------------

http://processors.wiki.ti.com/index.php/Processor_Linux_SDK_Graphics_and_Display
